<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pixelcraft CPU vs GPU vs TPU</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PIXEL FONT -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Press Start 2P', cursive;
    background: linear-gradient(180deg, #5da130 0%, #3b7a1a 100%);
    color: white;
    min-height: 100vh;
    padding: 20px;
    overflow-x: hidden;
}

.container {
    max-width: 1400px;
    margin: auto;
    position: relative;
    z-index: 1; /* above floating blocks */
}

header {
    text-align: center;
    margin-bottom: 30px;
}

h1 {
    color: #6cff2a;
    text-shadow: 4px 4px 0px #1b4d0f;
    font-size: 2em;
}

.subtitle {
    color: #d9ffb3;
    font-size: 0.7em;
}

/* BLOCK STYLE */
.processor-card, .controls, .info-card {
    background: #8b5a2b;
    border: 4px solid #5a3a1a;
    border-radius: 6px;
    padding: 20px;
    box-shadow: inset -4px -4px 0px #6b4423;
}

.demo-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 25px;
    margin-top: 20px;
}

.processor-card.cpu { border-color: #c0392b; }
.processor-card.gpu { border-color: #27ae60; }
.processor-card.tpu { border-color: #8e44ad; }

.processor-name {
    font-size: 1em;
    text-shadow: 2px 2px 0px #000;
}

.card-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    align-items: center;
}

.time-display {
    background: #000;
    padding: 6px 10px;
    border: 2px solid #6cff2a;
    font-size: 0.7em;
}

/* CANVAS */
.canvas-container {
    background: #000;
    border: 4px solid #333;
    border-radius: 0;
    margin-bottom: 10px;
    position: relative;
}

canvas {
    width: 100%;
    height: 250px;
    image-rendering: pixelated;
    display: block;
}

.status {
    position: absolute;
    bottom: 6px;
    left: 6px;
    background: #222;
    border: 2px solid #555;
    padding: 5px 8px;
    font-size: 0.6em;
}

/* CONTROLS */
.controls {
    margin-bottom: 25px;
}

.control-group label {
    font-size: 0.7em;
}

.slider {
    width: 100%;
    margin-top: 10px;
}

.slider::-webkit-slider-thumb {
    background: #6cff2a;
}

.button-group {
    margin-top: 20px;
    display: flex;
    gap: 15px;
}

button {
    font-family: 'Press Start 2P', cursive;
    padding: 12px;
    font-size: 0.6em;
    border-radius: 0;
    border: 3px solid black;
    cursor: pointer;
    box-shadow: inset -3px -3px 0 rgba(0,0,0,0.4);
}

.btn-start { background: #27ae60; }
.btn-start:hover { background: #2ecc71; }

.btn-reset { background: #c0392b; }
.btn-reset:hover { background: #e74c3c; }

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* INFO CARDS (not used, but kept) */
.info-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.info {
    font-size: 0.6em;
}

.info-card h3 {
    font-size: 0.8em;
}

.info-card p {
    font-size: 0.6em;
}

/* FLOATING MINECRAFT-STYLE BLOCKS (kept for theme) */
.floating-block {
    position: fixed;
    width: 48px;
    height: 48px;
    z-index: 0;
    border: 3px solid #000;
    box-shadow: 0 4px 0 rgba(0,0,0,0.5);
    background:
        linear-gradient(to bottom, #3fa703 0 35%, #2b7a02 35% 40%, #8b5a2b 40% 100%);
    image-rendering: pixelated;
    animation: floatBlock 10s ease-in-out infinite;
    opacity: 0.9;
}

/* Individual positions & timings */
.block1 { top: 8%;  left: 4%;  animation-duration: 14s; }
.block2 { top: 18%; right: 6%; animation-duration: 11s; }
.block3 { bottom: 12%; left: 12%; animation-duration: 16s; }
.block4 { bottom: 18%; right: 14%; animation-duration: 13s; }

@keyframes floatBlock {
    0%   { transform: translateY(0) translateX(0) rotate(0deg); }
    25%  { transform: translateY(-15px) translateX(10px) rotate(-2deg); }
    50%  { transform: translateY(-5px) translateX(-10px) rotate(2deg); }
    75%  { transform: translateY(-18px) translateX(5px) rotate(-1deg); }
    100% { transform: translateY(0) translateX(0) rotate(0deg); }
}

/* language selector row */
.langbar {
    display: flex;
    justify-content: center;
    gap: 12px;
    align-items: center;
    margin-top: 16px;
    flex-wrap: wrap;
}

/* ‚úÖ FIX: unicode-safe font for dropdown + options */
#languageSelect, #languageSelect option {
    font-family: system-ui, -apple-system, BlinkMacSystemFont,
                 "Segoe UI", Roboto, Arial, sans-serif;
    font-size: 0.65em;
}

#languageSelect {
    padding: 10px 12px;
    border: 3px solid #000;
    background: #d9ffb3;
    cursor: pointer;
}
</style>
</head>

<body>

<!-- Floating Pixelcraft-style grass blocks -->
<div class="floating-block block1"></div>
<div class="floating-block block2"></div>
<div class="floating-block block3"></div>
<div class="floating-block block4"></div>

<div class="container">

<header>
    <h1
      data-en="‚õè CPU vs GPU vs TPU ‚õè"
      data-de="‚õè CPU vs GPU vs TPU ‚õè"
      data-es="‚õè CPU vs GPU vs TPU ‚õè"
      data-pt="‚õè CPU vs GPU vs TPU ‚õè"
    >‚õè CPU vs GPU vs TPU ‚õè</h1>

    <p class="subtitle"
       data-en="Pixelcraft Parallel Processing Demo"
       data-de="Pixelcraft-Demo zur Parallelverarbeitung"
       data-es="Demo de procesamiento paralelo en Pixelcraft"
       data-pt="Demonstra√ß√£o de processamento paralelo no Pixelcraft"
    >Pixelcraft Parallel Processing Demo</p>

    <div class="langbar" aria-label="Language selector">
        <span
          data-en="Language:"
          data-de="Sprache:"
          data-es="Idioma:"
          data-pt="Idioma:"
        >Language:</span>

        <select id="languageSelect" aria-label="Select language">
            <option value="en">üá¨üáß English</option>
            <option value="de">üá©üá™ Deutsch</option>
            <option value="es">üá™üá∏ Espa√±ol</option>
            <option value="pt">üáµüáπ Portugu√™s</option>
        </select>
    </div>
</header>

<div class="controls">
    <div class="control-group">
        <label id="resolutionLabel"
          data-en="World Resolution:"
          data-de="Weltaufl√∂sung:"
          data-es="Resoluci√≥n del mundo:"
          data-pt="Resolu√ß√£o do mundo:"
        >World Resolution:</label>
        <span id="resolutionValue">64x64</span>
        <input type="range" class="slider" id="resolutionSlider" min="32" max="128" step="16" value="64">
    </div>

    <div class="button-group">
        <button class="btn-start" id="startBtn"
          data-en="‚ñ∂ Start Mining"
          data-de="‚ñ∂ Abbau starten"
          data-es="‚ñ∂ Empezar a minar"
          data-pt="‚ñ∂ Come√ßar a minerar"
        >‚ñ∂ Start Mining</button>
        <button class="btn-reset" id="resetBtn"
          data-en="‚õè Reset World"
          data-de="‚õè Welt zur√ºcksetzen"
          data-es="‚õè Reiniciar mundo"
          data-pt="‚õè Redefinir mundo"
        >‚õè Reset World</button>
    </div>
</div>

<div class="demo-grid">

    <div class="processor-card cpu">
        <div class="card-header">
            <div class="processor-name"
              data-en="‚öí CPU Miner"
              data-de="‚öí CPU-Sch√ºrfer"
              data-es="‚öí Minero CPU"
              data-pt="‚öí Minerador CPU"
            >‚öí CPU Miner</div>
            <div class="time-display" id="cpuTime">0.00s</div>
        </div>
        <div class="canvas-container">
            <canvas id="cpuCanvas"></canvas>
            <div class="status" id="cpuStatus"
              data-en="Ready"
              data-de="Bereit"
              data-es="Listo"
              data-pt="Pronto"
            >Ready</div>
        </div>
        <div class="info"
          data-en="Slow mining ‚Äî one block at a time."
          data-de="Langsamer Abbau ‚Äî Block f√ºr Block."
          data-es="Miner√≠a lenta ‚Äî un bloque a la vez."
          data-pt="Minera√ß√£o lenta ‚Äî um bloco por vez."
        >Slow mining ‚Äî one block at a time.</div>
    </div>

    <div class="processor-card gpu">
        <div class="card-header">
            <div class="processor-name"
              data-en="üíé GPU Crafter"
              data-de="üíé GPU-Crafter"
              data-es="üíé Artesano GPU"
              data-pt="üíé Artes√£o GPU"
            >üíé GPU Crafter</div>
            <div class="time-display" id="gpuTime">0.00s</div>
        </div>
        <div class="canvas-container">
            <canvas id="gpuCanvas"></canvas>
            <div class="status" id="gpuStatus"
              data-en="Ready"
              data-de="Bereit"
              data-es="Listo"
              data-pt="Pronto"
            >Ready</div>
        </div>
        <div class="info"
          data-en="Fast mining ‚Äî multiple rows at once."
          data-de="Schneller Abbau ‚Äî mehrere Reihen auf einmal."
          data-es="Miner√≠a r√°pida ‚Äî varias filas a la vez."
          data-pt="Minera√ß√£o r√°pida ‚Äî v√°rias linhas de uma vez."
        >Fast mining ‚Äî multiple rows at once.</div>
    </div>

    <div class="processor-card tpu">
        <div class="card-header">
            <div class="processor-name"
              data-en="üß† TPU Redstone Core"
              data-de="üß† TPU-Redstone-Kern"
              data-es="üß† N√∫cleo Redstone TPU"
              data-pt="üß† N√∫cleo Redstone TPU"
            >üß† TPU Redstone Core</div>
            <div class="time-display" id="tpuTime">0.00s</div>
        </div>
        <div class="canvas-container">
            <canvas id="tpuCanvas"></canvas>
            <div class="status" id="tpuStatus"
              data-en="Ready"
              data-de="Bereit"
              data-es="Listo"
              data-pt="Pronto"
            >Ready</div>
        </div>
        <div class="info"
          data-en="Instant mining ‚Äî entire chunk at once."
          data-de="Sofortiger Abbau ‚Äî ganzer Chunk auf einmal."
          data-es="Miner√≠a instant√°nea ‚Äî el chunk completo de una vez."
          data-pt="Minera√ß√£o instant√¢nea ‚Äî o chunk inteiro de uma vez."
        >Instant mining ‚Äî entire chunk at once.</div>
    </div>

</div>

</div>

<!-- MAIN SCRIPT: language -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    function setLanguage(lang) {
        document.querySelectorAll('[data-en]').forEach(el => {
            const text = el.getAttribute(`data-${lang}`) || el.getAttribute('data-en');
            if (text !== null) el.textContent = text;
        });
        localStorage.setItem('selectedLanguage', lang);
        updateResolutionText();
    }

    const langSelect = document.getElementById('languageSelect');
    const savedLang = localStorage.getItem('selectedLanguage') || 'en';
    if (langSelect) {
        langSelect.value = savedLang;
        setLanguage(savedLang);
        langSelect.addEventListener('change', (e) => setLanguage(e.target.value));
    } else {
        setLanguage(savedLang);
    }

    window.__getLang = () => (localStorage.getItem('selectedLanguage') || 'en');
});
</script>

<!-- DEMO SCRIPT -->
<script>
// Controls & elements
var resolutionSlider = document.getElementById('resolutionSlider');
var resolutionValue  = document.getElementById('resolutionValue');
var startBtn         = document.getElementById('startBtn');
var resetBtn         = document.getElementById('resetBtn');

var cpuCanvas = document.getElementById('cpuCanvas');
var gpuCanvas = document.getElementById('gpuCanvas');
var tpuCanvas = document.getElementById('tpuCanvas');

var cpuCtx = cpuCanvas.getContext('2d');
var gpuCtx = gpuCanvas.getContext('2d');
var tpuCtx = tpuCanvas.getContext('2d');

var cpuTime   = document.getElementById('cpuTime');
var gpuTime   = document.getElementById('gpuTime');
var tpuTime   = document.getElementById('tpuTime');

var cpuStatus = document.getElementById('cpuStatus');
var gpuStatus = document.getElementById('gpuStatus');
var tpuStatus = document.getElementById('tpuStatus');

var resolution   = 64;
var isRunning    = false;
var cancelRender = false;

function updateResolutionText() {
    resolutionValue.textContent = resolution + "x" + resolution;
}

function setCanvasSize() {
    cpuCanvas.width = resolution;
    cpuCanvas.height = resolution;
    gpuCanvas.width = resolution;
    gpuCanvas.height = resolution;
    tpuCanvas.width = resolution;
    tpuCanvas.height = resolution;
}
setCanvasSize();

resolutionSlider.addEventListener('input', function(e){
    resolution = parseInt(e.target.value);
    updateResolutionText();
    setCanvasSize();
    resetAll();
});

function resetAll(){
    cpuCtx.fillStyle = '#000';
    cpuCtx.fillRect(0, 0, resolution, resolution);
    gpuCtx.fillStyle = '#000';
    gpuCtx.fillRect(0, 0, resolution, resolution);
    tpuCtx.fillStyle = '#000';
    tpuCtx.fillRect(0, 0, resolution, resolution);

    cpuTime.textContent = '0.00s';
    gpuTime.textContent = '0.00s';
    tpuTime.textContent = '0.00s';

    var lang = (window.__getLang && window.__getLang()) || 'en';
    cpuStatus.textContent = cpuStatus.getAttribute('data-' + lang) || cpuStatus.getAttribute('data-en') || 'Ready';
    gpuStatus.textContent = gpuStatus.getAttribute('data-' + lang) || gpuStatus.getAttribute('data-en') || 'Ready';
    tpuStatus.textContent = tpuStatus.getAttribute('data-' + lang) || tpuStatus.getAttribute('data-en') || 'Ready';
}

// Same gradient color for all three
function generatePixelColor(x, y){
    var hue = (x / resolution * 360 + y / resolution * 180) % 360;
    var saturation = 70;
    var lightness = 50;
    return 'hsl(' + hue + ', ' + saturation + '%, ' + lightness + '%)';
}

// HSL to RGB helper (for TPU imageData)
function hslToRgb(h, s, l) {
    var r, g, b;
    if (s === 0) { r = g = b = l; }
    else {
        function hue2rgb(p, q, t) {
            if (t < 0) t += 1;
            if (t > 1) t -= 1;
            if (t < 1/6) return p + (q - p) * 6 * t;
            if (t < 1/2) return q;
            if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
            return p;
        }
        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        var p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
    }
    return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
}

function t(key) {
    var lang = (window.__getLang && window.__getLang()) || 'en';
    var dict = {
        mining: { en:"Mining...", de:"Baue ab...", es:"Minando...", pt:"Minerando..." },
        done:   { en:"Done!",    de:"Fertig!",   es:"¬°Listo!",  pt:"Feito!" }
    };
    return (dict[key] && (dict[key][lang] || dict[key].en)) || key;
}

// CPU: sequential
function renderCPU(){
    return new Promise(resolve=>{
        cpuStatus.textContent = t("mining");
        var x = 0, y = 0;
        var start = performance.now();

        function step(){
            if (cancelRender) { resolve(); return; }

            if (y >= resolution) {
                cpuTime.textContent = ((performance.now()-start)/1000).toFixed(2) + "s";
                cpuStatus.textContent = t("done");
                resolve();
                return;
            }

            cpuCtx.fillStyle = generatePixelColor(x, y);
            cpuCtx.fillRect(x, y, 1, 1);

            x++;
            if (x >= resolution) { x = 0; y++; }

            setTimeout(step, 0);
        }
        step();
    });
}

// GPU: batched rows
function renderGPU(){
    return new Promise(resolve=>{
        gpuStatus.textContent = t("mining");
        var y = 0;
        var rowsPerBatch = 4;
        var start = performance.now();

        function step(){
            if (cancelRender) { resolve(); return; }

            if (y >= resolution) {
                gpuTime.textContent = ((performance.now()-start)/1000).toFixed(2) + "s";
                gpuStatus.textContent = t("done");
                resolve();
                return;
            }

            for (var dy = 0; dy < rowsPerBatch && y+dy < resolution; dy++){
                for (var x = 0; x < resolution; x++){
                    gpuCtx.fillStyle = generatePixelColor(x, y+dy);
                    gpuCtx.fillRect(x, y+dy, 1, 1);
                }
            }

            y += rowsPerBatch;
            setTimeout(step, 10);
        }
        step();
    });
}

// TPU: full image in one go (same gradient)
function renderTPU(){
    return new Promise(resolve=>{
        tpuStatus.textContent = t("mining");
        var start = performance.now();

        var imageData = tpuCtx.createImageData(resolution, resolution);
        var data = imageData.data;

        for (var yy = 0; yy < resolution; yy++) {
            for (var xx = 0; xx < resolution; xx++) {
                var color = generatePixelColor(xx, yy);
                var match = color.match(/hsl\((\d+\.?\d*),\s*(\d+\.?\d*)%,\s*(\d+\.?\d*)%\)/);
                if (match) {
                    var h = parseFloat(match[1]) / 360;
                    var s = parseFloat(match[2]) / 100;
                    var l = parseFloat(match[3]) / 100;
                    var rgb = hslToRgb(h, s, l);

                    var idx = (yy * resolution + xx) * 4;
                    data[idx]     = rgb[0];
                    data[idx + 1] = rgb[1];
                    data[idx + 2] = rgb[2];
                    data[idx + 3] = 255;
                }
            }
        }

        setTimeout(function(){
            if (!cancelRender) {
                tpuCtx.putImageData(imageData, 0, 0);
                tpuTime.textContent = ((performance.now() - start)/1000).toFixed(2) + "s";
                tpuStatus.textContent = t("done");
            }
            resolve();
        }, 50);
    });
}

// Start button
startBtn.onclick = function(){
    if (isRunning) return;
    cancelRender = false;
    isRunning = true;

    startBtn.disabled = true;
    resetBtn.disabled = true;
    resolutionSlider.disabled = true;

    resetAll();

    Promise.all([
        renderCPU(),
        renderGPU(),
        renderTPU()
    ]).then(function(){
        if (!cancelRender) {
            isRunning = false;
            startBtn.disabled = false;
            resetBtn.disabled = false;
            resolutionSlider.disabled = false;
        }
    });
};

// Reset button: cancels and clears immediately
resetBtn.onclick = function(){
    cancelRender = true;
    isRunning = false;
    startBtn.disabled = false;
    resetBtn.disabled = false;
    resolutionSlider.disabled = false;
    resetAll();
};

updateResolutionText();
resetAll();
</script>

</body>
</html>
